<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yacht Charter Price Calculator — GitHub Pages Fix</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Use Tailwind CDN (precompiled). No @apply used to avoid JIT issues on GH Pages -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">
  <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl">
    <header class="mb-8 text-center">
      <h1 class="text-3xl font-bold text-indigo-700">Yacht Charter Price Calculator</h1>
      <p class="text-gray-600 mt-1">Please fill in the information below to calculate your yacht charter cost.</p>
    </header>

    <!-- Step 1: Number of People -->
    <div class="mb-6">
      <label for="numPax" class="block text-lg text-gray-700 mb-1 font-medium">1. 請輸入乘客人數 (Please enter the number of passengers):</label>
      <div class="flex gap-2">
        <input type="number" id="numPax" name="numPax" min="1" inputmode="numeric" pattern="[0-9]*"
               class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-lg"
               placeholder="例如 10 / e.g., 10">
        <button id="proceedBtn" class="mt-1 shrink-0 px-4 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700">
          下一步
        </button>
      </div>
      <p id="numHint" class="text-xs text-gray-500 mt-1">提示：輸入人數後會自動顯示可用船隻；若無反應，請按「下一步」。</p>
    </div>

    <!-- Step 2: Yacht Selection (Dropdown) -->
    <div id="yachtSelectionSection" class="mb-6 hidden">
      <label for="yachtSelect" class="block text-lg text-gray-700 mb-1 font-medium">2. 請選擇遊艇 (Please select a yacht):</label>
      <select id="yachtSelect" name="yachtSelect" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-lg"></select>
      <p id="noYachtMessage" class="text-red-500 mt-2 hidden">Sorry, no yachts available for the selected number of passengers.</p>
    </div>

    <!-- Yacht Details & Further Options (Initially Hidden) -->
    <div id="yachtDetailsAndOptions" class="hidden">
      <hr class="my-6 border-gray-300">

      <!-- Step 3: Time Slot -->
      <div class="mb-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-3">3. 請選擇時段 (Please select a time slot):</h2>
        <div class="flex flex-wrap gap-4">
          <label class="flex items-center gap-2">
            <input type="radio" id="timeslot_weekday" name="timeslot" value="weekday" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
            <span class="text-sm text-gray-900">平日 (Weekday)</span>
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" id="timeslot_weekend" name="timeslot" value="weekend" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
            <span class="text-sm text-gray-900">週末 (Weekend)</span>
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" id="timeslot_ph" name="timeslot" value="ph" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
            <span class="text-sm text-gray-900">公眾假期 (Public Holiday)</span>
          </label>
        </div>
      </div>

      <!-- Step 4: Duration -->
      <div class="mb-6">
        <label for="duration" class="block text-sm font-medium text-gray-700 mb-1">4. 請選擇租賃時長（小時）(Please select charter duration (hours)):</label>
        <div class="flex items-center gap-4">
          <input type="range" id="duration" name="duration" min="4" max="8" value="4" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
          <span id="durationValue" class="font-semibold text-indigo-700 w-24 text-center">4 hours</span>
        </div>
      </div>

      <!-- Step 5: Discount -->
      <div class="mb-6">
        <label for="discount" class="block text-sm font-medium text-gray-700 mb-1">5. 選擇折扣（可選）(Select discount (optional)):</label>
        <select id="discount" name="discount" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          <option value="0">無折扣 (No discount)</option>
          <option value="0.05">5% Discount</option>
          <option value="0.06">6% Discount</option>
          <option value="0.07">7% Discount</option>
          <option value="0.08">8% Discount</option>
          <option value="0.09">9% Discount</option>
          <option value="0.10">10% Discount</option>
        </select>
      </div>

      <!-- Step 6: Add-on Services -->
      <div id="addonsSection" class="mb-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-3">6. 選擇附加服務（可選）(Select add-on services (optional)):</h2>
        <div id="addonsList" class="space-y-2"></div>
      </div>

      <hr class="my-6 border-gray-300">

      <!-- Selected Yacht Info -->
      <div id="selectedYachtInfo" class="mb-6 bg-indigo-50 p-4 rounded-lg"></div>
    </div>

    <!-- Price Display -->
    <div id="priceDisplaySection" class="mt-8 p-6 bg-gray-50 rounded-lg shadow hidden">
      <h2 class="text-2xl font-bold text-indigo-700 mb-4 text-center">價格總計 (Price Summary)</h2>
      <div id="priceBreakdown" class="space-y-2"></div>
      <p id="finalPrice" class="text-3xl font-extrabold text-green-600 mt-6 text-center"></p>
      <p id="gstDisclaimer" class="text-xs text-gray-500 mt-2 text-center"></p>
    </div>
  </div>

  <script>
  // Everything runs after DOM is ready (avoids GH Pages timing issues)
  document.addEventListener('DOMContentLoaded', function() {
    const yachtData = [
      { 
        "id": "yacht_ew1", 
        "name": "Eagle Wing 1", 
        "basePax": 5, 
        "maxCapacity": 50, 
        "prices": { 
          "weekday": { "base4h": 2950, "subsequentHour": 650, "specificExtraPaxCost": 70 }, 
          "weekend": { "base4h": 3540, "subsequentHour": 780, "specificExtraPaxCost": 84 }, 
          "ph":      { "base4h": 3540, "subsequentHour": 780, "specificExtraPaxCost": 84 } 
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "includedServices": "‧ 2 Bedrooms w/ Ensuite bathroom for use\\n‧ For Charter within Singapore Waters\\n‧ Includes ice, free-flow soft drinks, Kayak, Paddle Board\\n‧ Floaties, Motorised Craft w/ Towing toy\\n‧ BBQ Pit with Cooking Service",
        "addons": [
          { "name": "WATER SLIDE", "price": 500, "selected": false, "id": "ew1_addon_water_slide" },
          { "name": "Jet-Ski (2hrs) + Towable", "price": 500, "selected": false, "id": "ew1_addon_jetski_2hr_towable" },
          { "name": "E-FOIL (per piece)", "price": 500, "selected": false, "id": "ew1_addon_efoil_pc" },
          { "name": "SEABOB (per piece)", "price": 500, "selected": false, "id": "ew1_addon_seabob_pc" },
          { "name": "JACUZZI", "price": 100, "selected": false, "id": "ew1_addon_jacuzzi" }
        ],
        "gstApplicable": true 
      },
      { 
        "id": "yacht_ew2", 
        "name": "Eagle Wing 2", 
        "basePax": 5, 
        "maxCapacity": 18, 
        "prices": { 
          "weekday": { "base4h": 1280, "subsequentHour": 350, "specificExtraPaxCost": 60 }, 
          "weekend": { "base4h": 1670, "subsequentHour": 350, "specificExtraPaxCost": 60 }, 
          "ph":      { "base4h": 1670, "subsequentHour": 350, "specificExtraPaxCost": 60 }  
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "includedServices": "‧ 2 Bedrooms w/ Ensuite bathroom for use\\n‧ For Charter within Singapore Waters\\n‧ Includes ice,free-flow soft drinks, Kayak, Paddle Board,\\n‧ Floaties, Motorised Craft w/ Towing toy,\\n‧ BBQ Pit with Cooking Service",
        "addons": [ 
          { "name": "Jet-Ski (2hrs) + Towable", "price": 500, "selected": false, "id": "ew2_addon_jetski_2hr_towable" },
          { "name": "E-FOIL (per piece)", "price": 500, "selected": false, "id": "ew2_addon_efoil_pc" },
          { "name": "SEABOB (per piece)", "price": 500, "selected": false, "id": "ew2_addon_seabob_pc" }
        ],
        "gstApplicable": true 
      },
      { 
        "id": "yacht_ew3",
        "name": "Eagle Wing 3", 
        "basePax": 10, 
        "maxCapacity": 55, 
        "prices": { 
          "weekday": { "base4h": 4680, "subsequentHour": 1000, "specificExtraPaxCost": 100 }, 
          "weekend": { "base4h": 5950, "subsequentHour": 1250, "specificExtraPaxCost": 120 }, 
          "ph":      { "base4h": 5950, "subsequentHour": 1250, "specificExtraPaxCost": 120 }  
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "includedServices": "-2 Bedrooms w/ Ensuite bathroom for use\\n-For Charter within Singapore Waters\\n-Includes ice,free-flow soft drinks, Kayak, Paddle Board,\\nFloaties, Motorised Craft w/ Towing toy,\\n-BBQ Pit with Cooking Service",
        "addons": [
          { "name": "WATER SLIDE", "price": 650, "selected": false, "id": "ew3_addon_water_slide" },
          { "name": "Jet-Ski (2hrs) + Towable", "price": 500, "selected": false, "id": "ew3_addon_jetski_2hr_towable" },
          { "name": "E-FOIL (per piece)", "price": 500, "selected": false, "id": "ew3_addon_efoil_pc" },
          { "name": "SEABOB (per piece)", "price": 500, "selected": false, "id": "ew3_addon_seabob_pc" },
          { "name": "JACUZZI", "price": 100, "selected": false, "id": "ew3_addon_jacuzzi" } 
        ],
        "gstApplicable": true 
      },
      { 
        "id": "yacht_skywalker", 
        "name": "Skywalker", 
        "basePax": 5, 
        "maxCapacity": 45,
        "prices": { 
          "weekday": { "base4h": 2380, "subsequentHour": 560, "specificExtraPaxCost": 70 }, 
          "weekend": { "base4h": 2856, "subsequentHour": 672, "specificExtraPaxCost": 84 }, 
          "ph":      { "base4h": 2856, "subsequentHour": 672, "specificExtraPaxCost": 84 }  
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "includedServices": "-2 Bedrooms w/ Ensuite bathroom for use\\n-For Charter within Singapore Waters\\n-Includes ice,free-flow soft drinks, Kayak, Paddle Board,\\nFloaties, Motorised Craft w/ Towing toy,\\n-BBQ Pit with Cooking Service",
        "addons": [ 
          { "name": "WATER SLIDE", "price": 450, "selected": false, "id": "skywalker_addon_water_slide" },
          { "name": "Jet-Ski (2hrs) + Towable", "price": 500, "selected": false, "id": "skywalker_addon_jetski_2hr_towable" },
          { "name": "E-FOIL (per piece)", "price": 500, "selected": false, "id": "skywalker_addon_efoil_pc" },
          { "name": "SEABOB (per piece)", "price": 500, "selected": false, "id": "skywalker_addon_seabob_pc" },
          { "name": "JACUZZI", "price": 200, "selected": false, "id": "skywalker_addon_jacuzzi" }
        ],
        "gstApplicable": true 
      },
      { 
        "id": "yacht_vesperglow",
        "name": "Vesper Glow", 
        "basePax": 5, 
        "maxCapacity": 15, 
        "prices": { 
          "weekday": { "base4h": 1290, "subsequentHour": 350, "specificExtraPaxCost": 80 }, 
          "weekend": { "base4h": 1540, "subsequentHour": 350, "specificExtraPaxCost": 80 }, 
          "ph":      { "base4h": 1540, "subsequentHour": 350, "specificExtraPaxCost": 80 }  
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "includedServices": "-2 Bedrooms w/ Ensuite bathroom for use\\n-For Charter within Singapore Waters\\n-Includes ice,free-flow soft drinks, Kayak, Paddle Board,\\nFloaties, Motorised Craft w/ Towing toy,\\n-BBQ Pit with Cooking Service",
        "addons": [
          { "name": "Jet-Ski (2hrs) + Towable", "price": 500, "selected": false, "id": "vesper_addon_jetski_2hr_towable" },
          { "name": "E-FOIL (per piece)", "price": 500, "selected": false, "id": "vesper_addon_efoil_pc" },
          { "name": "SEABOB (per piece)", "price": 500, "selected": false, "id": "vesper_addon_seabob_pc" },
          { "name": "JACUZZI", "price": 200, "selected": false, "id": "vesper_addon_jacuzzi" }
        ],
        "gstApplicable": true 
      },
      { 
        "id": "yacht_mseternity",
        "name": "MS Eternity",
        "basePax": 10, 
        "maxCapacity": 35, 
        "prices": { 
          "weekday": { "base4h": 1688, "subsequentHour": 250, "specificExtraPaxCost": 80 }, 
          "weekend": { "base4h": 2088, "subsequentHour": 450, "specificExtraPaxCost": 80 }, 
          "ph":      { "base4h": 2088, "subsequentHour": 450, "specificExtraPaxCost": 80 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "includedServices": "‧ Mineral Water (Free Flow)\\n‧ Soft Drinks (Free flow Coke Zero & Green Tea only)\\n‧ 1 packet Ice (18 kg)\\n‧ Karaoke System\\n‧ Mahjong Table\\n‧ 2 Fishing Rod\\n‧ 2 x Single Seater Kayak\\n‧ Water Mat\\n‧ Stand Up paddle board\\n‧ Sublue Scooter\\n‧ BBQ Pit with Cooking Service", 
        "addons": [ 
          { "name": "Giant Unicorn Float", "price": 200, "selected": false, "id": "mseternity_addon_unicorn_float" },
          { "name": "Giant Water Slide", "price": 300, "selected": false, "id": "mseternity_addon_water_slide" },
          { "name": "E Wave Board (2 hours with instructor)", "price": 500, "selected": false, "id": "mseternity_addon_ewave" },
          { "name": "Jetski (pillion only, guest not allowed to operate)", "price": 440, "selected": false, "id": "mseternity_addon_jetski_pillion" },
          { "name": "Shroomy Float", "price": 100, "selected": false, "id": "mseternity_addon_shroomy_float" }
        ],
        "gstApplicable": true 
      },
      { 
        "id": "yacht_anka", 
        "name": "Anka",
        "basePax": 15, 
        "maxCapacity": 50,
        "prices": { 
          "weekday": { "base4h": 2675, "subsequentHour": 1000, "specificExtraPaxCost": 100 }, 
          "weekend": { "base4h": 3210, "subsequentHour": 1200, "specificExtraPaxCost": 120 }, 
          "ph":      { "base4h": 3852, "subsequentHour": 1500, "specificExtraPaxCost": 144 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": true,
        "includedServices": "‧ Free Flow Soft Drinks\\n‧ Watertoys Usage\\n‧ Two Karaoke Systems\\n‧ Jacuzzi\\n‧ Grill rental with grill service ($360 value - included)", 
        "addons": [ 
          { "name": "Jet ski (2 hours)", "price": 580, "selected": false, "id": "anka_addon_jetski_2hr" },
          { "name": "Jet ski (3 hours)", "price": 750, "selected": false, "id": "anka_addon_jetski_3hr" },
          { "name": "Projector + Screen Rental", "price": 160, "selected": false, "id": "anka_addon_projector_screen" },
          { "name": "Ice (18kg per bag)", "price": 18, "selected": false, "id": "anka_addon_ice_bag" }
        ]
      },
      { 
        "id": "yacht_aquaholic",
        "name": "Aquaholic",
        "basePax": 8,
        "maxCapacity": 18,
        "prices": { 
          "weekday": { "base4h": 1100, "subsequentHour": 200, "specificExtraPaxCost": 80 }, 
          "weekend": { "base4h": 1280, "subsequentHour": 200, "specificExtraPaxCost": 80 }, 
          "ph":      { "base4h": 1280, "subsequentHour": 200, "specificExtraPaxCost": 80 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": true,
        "includedServices": "‧ Watertoys\\n‧ Karaoke Systems\\n‧ Ice + Ice box",
        "addons": [
          { "name": "Grill rental with grill service", "price": 150, "selected": false, "id": "aquaholic_addon_grill_service" }
        ]
      },
      { 
        "id": "yacht_leviantha8",
        "name": "Leviantha8",
        "basePax": 10,
        "maxCapacity": 55,
        "prices": { 
          "weekday": { "base4h": 4388, "subsequentHour": 1088, "specificExtraPaxCost": 98 }, 
          "weekend": { "base4h": 5688, "subsequentHour": 1388, "specificExtraPaxCost": 118 }, 
          "ph":      { "base4h": 5688, "subsequentHour": 1388, "specificExtraPaxCost": 118 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": true,
        "includedServices": "‧ Watertoys\\n‧ Karaoke Systems\\n‧ Ice + Ice box\\n‧ Free flow drink",
        "addons": [
          { "name": "Grill rental with grill service", "price": 350, "selected": false, "id": "leviantha8_addon_grill_service" },
          { "name": "Jet ski (2 hours)", "price": 600, "selected": false, "id": "leviantha8_addon_jetski_2hr" },
          { "name": "Water slide", "price": 708, "selected": false, "id": "leviantha8_addon_water_slide" },
          { "name": "Jacuzzi", "price": 138, "selected": false, "id": "leviantha8_addon_jacuzzi" }
        ]
      },
      { 
        "id": "yacht_argon",
        "name": "Argon",
        "basePax": 7,
        "maxCapacity": 18,
        "prices": { 
          "weekday": { "base4h": 770, "subsequentHour": 200, "specificExtraPaxCost": 70 }, 
          "weekend": { "base4h": 950, "subsequentHour": 200, "specificExtraPaxCost": 70 }, 
          "ph":      { "base4h": 950, "subsequentHour": 200, "specificExtraPaxCost": 70 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": false, 
        "includedServices": "‧ Watertoys\\n‧ Karaoke Systems\\n‧ Ice + Ice box\\n‧ Grill rental with grill service\\n‧ Water + 1 regular coke\\n‧ Skyline viewing",
        "addons": [] 
      },
      { 
        "id": "yacht_escapade",
        "name": "Escapade",
        "basePax": 10,
        "maxCapacity": 32,
        "prices": { 
          "weekday": { "base4h": 1000, "subsequentHour": 200, "specificExtraPaxCost": 70 }, 
          "weekend": { "base4h": 1200, "subsequentHour": 200, "specificExtraPaxCost": 70 }, 
          "ph":      { "base4h": 1200, "subsequentHour": 200, "specificExtraPaxCost": 70 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": false, 
        "includedServices": "‧ Watertoys\\n‧ Karaoke Systems\\n‧ Ice + Ice box\\n‧ Grill rental with grill service\\n‧ Water + 1 regular coke\\n‧ Skyline viewing",
        "addons": [] 
      },
      { 
        "id": "yacht_sunrise",
        "name": "SunRise",
        "basePax": 10,
        "maxCapacity": 18,
        "prices": { 
          "weekday": { "base4h": 799, "subsequentHour": 0, "specificExtraPaxCost": 80 }, 
          "weekend": { "base4h": 999, "subsequentHour": 0, "specificExtraPaxCost": 80 }, 
          "ph":      { "base4h": 1199, "subsequentHour": 0, "specificExtraPaxCost": 80 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": false, 
        "includedServices": "‧ 1 kayak, 1 stand up paddle, 2 snorkel kits, 2 fishing rods (excluding bait) and 1 floating mat\\n‧ Karaoke Systems\\n‧ Ice + Ice box\\n‧ Grill rental with grill service\\n‧ Skyline viewing\\n‧ One 15 marina", 
        "addons": [ 
          { "name": "BBQ pit rental + BBQ service", "price": 150, "selected": false, "id": "sunrise_addon_bbq_pit_service" }
        ] 
      },
      { 
        "id": "yacht_sunrider",
        "name": "SunRider",
        "basePax": 10,
        "maxCapacity": 16,
        "prices": { 
          "weekday": { "base4h": 499, "subsequentHour": 0, "specificExtraPaxCost": 60 }, 
          "weekend": { "base4h": 699, "subsequentHour": 0, "specificExtraPaxCost": 60 }, 
          "ph":      { "base4h": 699, "subsequentHour": 0, "specificExtraPaxCost": 60 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": false, 
        "includedServices": "‧ 2 stand up paddles, 2 snorkel kits, 2 fishing rods (excluding bait) and 1 floating mat\\n‧ Karaoke Systems\\n‧ Ice + Ice box\\n‧ Grill rental with grill service\\n‧ Skyline viewing\\n‧ Keppel bay", 
        "addons": [ 
          { "name": "BBQ pit rental + BBQ service", "price": 150, "selected": false, "id": "sunrider_addon_bbq_pit_service" }
        ] 
      },
      { 
        "id": "yacht_sgyacht",
        "name": "SGyacht",
        "basePax": 10,
        "maxCapacity": 28,
        "prices": { 
          "weekday": { "base4h": 599, "base5h": 799, "subsequentHour": 300, "specificExtraPaxCost": 65 }, 
          "weekend": { "base4h": 999, "base5h": 1150, "subsequentHour": 300, "specificExtraPaxCost": 65 }, 
          "ph":      { "base4h": 1199, "base5h": 1150, "subsequentHour": 300, "specificExtraPaxCost": 80 }
        },
        "hasSpecial5hrRate": true, 
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": true, 
        "includedServices": "‧ Karaoke\\n‧ Bar counter\\n‧ Microwave/Oven\\n‧ Bluetooth-compatible Stereo System\\n‧ Fully Air-Conditioned saloon\\n‧ Washrooms and Shower Room\\n‧ 1x Changing room\\n‧ 1x Double seater Kayak w 2 paddles (Damage/lost fee $150)\\n‧ 1x Stand up paddleboard w 1 paddle (Damage/lost fee $150)\\n‧ 1x Floating Mat (Damage fee $200)",
        "addons": [
          { "name": "BBQ pit rental + BBQ service", "price": 200, "selected": false, "id": "sgyacht_addon_bbq_pit_service" },
          { "name": "Disposable dining set", "price": 50, "selected": false, "id": "sgyacht_addon_disposable_dining" },
          { "name": "Ice 25kg", "price": 25, "selected": false, "id": "sgyacht_addon_ice_25kg" },
          { "name": "Pet Surcharge (per pet, not allowed in Saloon)", "price": 100, "selected": false, "id": "sgyacht_addon_pet_surcharge" }
        ]
      },
      { 
        "id": "yacht_mikanna",
        "name": "Mikanna",
        "basePax": 0, 
        "maxCapacity": 33,
        "priceTiers": { 
          "weekday": [ 
            { "upToPax": 6,  "base4h": 900 }, { "upToPax": 8,  "base4h": 1000 },
            { "upToPax": 10, "base4h": 1100 },{ "upToPax": 15, "base4h": 1300 },
            { "upToPax": 20, "base4h": 1700 },{ "upToPax": 25, "base4h": 1875 },
            { "upToPax": 30, "base4h": 2100 },{ "upToPax": 33, "base4h": 2310 }
          ],
          "weekend": [ 
            { "upToPax": 6,  "base4h": 1200 }, { "upToPax": 8,  "base4h": 1500 },
            { "upToPax": 10, "base4h": 1700 },{ "upToPax": 15, "base4h": 2200 },
            { "upToPax": 20, "base4h": 2500 },{ "upToPax": 25, "base4h": 2800 },
            { "upToPax": 30, "base4h": 3000 },{ "upToPax": 33, "base4h": 3300 }
          ],
          "ph": []
        },
        "subsequentHourRateForAllTiers": 250,
        "extraPaxCost": 0, 
        "variableExtraPax": false, 
        "gstApplicable": true, 
        "hasTieredPaxPricing": true, 
        "includedServices": "‧ Karaoke\\n‧ Watertoys\\n‧ BBQ grill rental with BBQ service",
        "addons": [] 
      },
      { 
        "id": "yacht_vincent",
        "name": "Vincent",
        "basePax": 12,
        "maxCapacity": 50,
        "prices": { 
          "weekday": { "base4h": 2699, "subsequentHour": 428, "specificExtraPaxCost": 98 }, 
          "weekend": { "base4h": 2899, "subsequentHour": 478, "specificExtraPaxCost": 98 }, 
          "ph":      { "base4h": 3478.8, "subsequentHour": 573.6, "specificExtraPaxCost": 117.6 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": true, 
        "includedServices": "‧ No Karaoke but have sound system\\n‧ Kayaks, Floaties\\n‧ BBQ grill rental with BBQ service",
        "addons": [
          { "name": "BBQ grills and services", "price": 200, "selected": false, "id": "vincent_addon_bbq_grills_services" },
          { "name": "2hrs Jetski (pillion only)", "price": 520, "selected": false, "id": "vincent_addon_jetski_pillion" },
          { "name": "Seabob", "price": 500, "selected": false, "id": "vincent_addon_seabob" }
        ]
      },
      { 
        "id": "yacht_island1",
        "name": "Island yacht 1",
        "basePax": 5,
        "maxCapacity": 30, 
        "prices": { 
          "weekday": { "base4h": 899, "subsequentHour": 300, "specificExtraPaxCost": 90 }, 
          "weekend": { "base4h": 1179, "subsequentHour": 300, "specificExtraPaxCost": 90 }, 
          "ph":      { "base4h": 1414.8, "subsequentHour": 360, "specificExtraPaxCost": 108 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": false, 
        "includedServices": "‧ BBQ Service\\n‧ BBQ Food\\n‧ City Skyline Cruise\\n‧ Karaoke KTV\\n‧ Kayak\\n‧ Paddle board\\n‧ Water Mat\\n‧ 1 pack of ice + drinking water",
        "addons": [
          { "name": "Giant Rainbow Float", "price": 50, "selected": false, "id": "island1_addon_rainbow_float" },
          { "name": "Giant Flamingo Float", "price": 50, "selected": false, "id": "island1_addon_flamingo_float" },
          { "name": "Fishing Rod & Frozen Baits (per set)", "price": 50, "selected": false, "id": "island1_addon_fishing_frozen" },
          { "name": "Fishing Rod & Live Baits (per set, $30 extra for live)", "price": 80, "selected": false, "id": "island1_addon_fishing_live" },
          { "name": "Snorkeling Mask", "price": 20, "selected": false, "id": "island1_addon_snorkel_mask" },
          { "name": "Jetski (2hrs)", "price": 580, "selected": false, "id": "island1_addon_jetski_2hr" },
          { "name": "Jetboard/E-Foil (coach + 1 E-Foil, 4hrs)", "price": 1000, "selected": false, "id": "island1_addon_jetboard_efoil_4hr" }
        ]
      },
      { 
        "id": "yacht_island2",
        "name": "Island yacht 2",
        "basePax": 7,
        "maxCapacity": 20,
        "prices": { 
          "weekday": { "base4h": 850, "subsequentHour": 300, "specificExtraPaxCost": 80 }, 
          "weekend": { "base4h": 1100, "subsequentHour": 300, "specificExtraPaxCost": 80 }, 
          "ph":      { "base4h": 1320, "subsequentHour": 360, "specificExtraPaxCost": 96 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": false, 
        "includedServices": "‧ City Skyline Cruise\\n‧ Karaoke KTV\\n‧ Kayak\\n‧ Water Mat\\n‧ 1 pack of ice + drinking water\\n‧ Giant rainbow float\\n‧ Giant flamingo float",
        "addons": [
          { "name": "BBQ Service", "price": 100, "selected": false, "id": "island2_addon_bbq_service" },
          { "name": "BBQ Food (per pax)", "price": 30, "selected": false, "id": "island2_addon_bbq_food" },
          { "name": "Fishing Rod & Frozen Baits (per set)", "price": 50, "selected": false, "id": "island2_addon_fishing_frozen" },
          { "name": "Fishing Rod & Live Baits (per set, $30 extra for live)", "price": 80, "selected": false, "id": "island2_addon_fishing_live" },
          { "name": "Snorkeling Mask (per piece)", "price": 20, "selected": false, "id": "island2_addon_snorkel_mask" },
          { "name": "Jetski (2hrs)", "price": 580, "selected": false, "id": "island2_addon_jetski_2hr" },
          { "name": "Jetboard/E-Foil (coach + 1 E-Foil, 4hrs)", "price": 1000, "selected": false, "id": "island2_addon_jetboard_efoil_4hr" }
        ]
      },
      { 
        "id": "yacht_oceandiva",
        "name": "Ocean Diva",
        "basePax": 8,
        "maxCapacity": 25,
        "prices": { 
          "weekday": { "base4h": 1200, "subsequentHour": 350, "specificExtraPaxCost": 80 }, 
          "weekend": { "base4h": 1600, "subsequentHour": 350, "specificExtraPaxCost": 80 }, 
          "ph":      { "base4h": 1600, "subsequentHour": 350, "specificExtraPaxCost": 80 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": false, 
        "includedServices": "‧ Free 18kg ice\\n‧ 100L cooler box usage\\n‧ Karaoke System\\n‧ Kitchenware, plates, cutlery and\\nplastic glassware\\n‧ 1 kayak (2 seater)，1 paddleboard，1 Floating water mat，water guns",
        "addons": [
          { "name": "BBQ grill rental with bbq Service", "price": 200, "selected": false, "id": "oceandiva_addon_bbq" },
          { "name": "Sea scooter", "price": 100, "selected": false, "id": "oceandiva_addon_sea_scooter" },
          { "name": "Electric Body board", "price": 150, "selected": false, "id": "oceandiva_addon_electric_bodyboard" },
          { "name": "Kids Waterslide", "price": 300, "selected": false, "id": "oceandiva_addon_kids_waterslide" }
        ]
      },
      { 
        "id": "yacht_ximula",
        "name": "Ximula",
        "basePax": 10,
        "maxCapacity": 18,
        "prices": { 
          "weekday": { "base4h": 1200, "subsequentHour": 200, "specificExtraPaxCost": 80 }, 
          "weekend": { "base4h": 1400, "subsequentHour": 200, "specificExtraPaxCost": 80 }, 
          "ph":      { "base4h": 1400, "subsequentHour": 200, "specificExtraPaxCost": 80 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": true,
        "includedServices": "‧ Free flow of coffee, tea, soft drinks & bottled water\\n‧ 1 double kayak, 1 stand up paddle board, 1 floating water mat\\n‧ BBQ grill rental with bbq Service",
        "addons": [] 
      },
      { 
        "id": "yacht_amethyst",
        "name": "AMETHYST",
        "basePax": 20, 
        "maxCapacity": 25,
        "prices": { 
          "weekday": { "base4h": 1600, "subsequentHour": 350, "specificExtraPaxCost": 80 }, 
          "weekend": { "base4h": 2000, "subsequentHour": 350, "specificExtraPaxCost": 80 }, 
          "ph":      { "base4h": 2400, "subsequentHour": 420, "specificExtraPaxCost": 96 }
        },
        "extraPaxCost": 0, 
        "variableExtraPax": true, 
        "gstApplicable": false, 
        "includedServices": "‧ Cooler box\\n‧ 1x 18KG bag of Ice\\n‧ Fridge\\n‧ Microwave Oven\\n‧ Karaoke System\\n‧ 1 Kayak\\n‧ 2 Stand up Paddleboard\\n‧ 1 Water mat\\n‧ City skyline cruise (MBS area)",
        "addons": [
          { "name": "BBQ pit rental with cooking service", "price": 200, "selected": false, "id": "amethyst_addon_bbq" },
          { "name": "Sea scooter", "price": 110, "selected": false, "id": "amethyst_addon_sea_scooter" }
        ]
      },

      { 
        "id": "yacht_mseternity2",
        "name": "Ms Eternity 2",
        "basePax": 10,
        "maxCapacity": 35,
        "prices": {
          "weekday": { "base4h": 1788, "subsequentHour": 350, "specificExtraPaxCost": 88 },
          "weekend": { "base4h": 2388, "subsequentHour": 550, "specificExtraPaxCost": 88 },
          "ph":      { "base4h": 2865.6, "subsequentHour": 660, "specificExtraPaxCost": 105.6 }
        },
        "extraPaxCost": 0,
        "variableExtraPax": true,
        "gstApplicable": true,
        "includedServices": "‧ 100 inch TV\\n‧ 1 kayak, 1 stand up paddle, 2 snorkel kits\\n‧ Karaoke Systems\\n‧ Ice + ice box\\n‧ Free flow Coke Zero & Green Tea\\n‧ Grill rental with grill service\\n‧ Skyline viewing",
        "addons": [
          { "name": "Giant Unicorn Float", "price": 200, "selected": false, "id": "mseternity2_addon_unicorn_float" },
          { "name": "Giant Water Slide", "price": 400, "selected": false, "id": "mseternity2_addon_water_slide" },
          { "name": "E Foil", "price": 500, "selected": false, "id": "mseternity2_addon_efoil" },
          { "name": "Jetski (pillion only, guests are not allowed to operate)", "price": 500, "selected": false, "id": "mseternity2_addon_jetski_pillion" }
        ]
      }
];

    // Populate PH tiers for Mikanna
    const mikanna = yachtData.find(y => y.id === "yacht_mikanna");
    if (mikanna) {
      mikanna.priceTiers.ph = JSON.parse(JSON.stringify(mikanna.priceTiers.weekend));
    }

    // DOM Elements
    const numPaxInput = document.getElementById('numPax');
    const proceedBtn = document.getElementById('proceedBtn');
    const yachtSelectionSection = document.getElementById('yachtSelectionSection');
    const yachtSelectElement = document.getElementById('yachtSelect');
    const noYachtMessage = document.getElementById('noYachtMessage');
    const yachtDetailsAndOptionsDiv = document.getElementById('yachtDetailsAndOptions');
    const selectedYachtInfoDiv = document.getElementById('selectedYachtInfo');
    const timeSlotRadios = document.querySelectorAll('input[name="timeslot"]');
    const durationInput = document.getElementById('duration');
    const durationValueSpan = document.getElementById('durationValue');
    const discountSelect = document.getElementById('discount');
    const addonsSectionDiv = document.getElementById('addonsSection');
    const addonsListDiv = document.getElementById('addonsList');
    const priceDisplaySectionDiv = document.getElementById('priceDisplaySection');
    const priceBreakdownDiv = document.getElementById('priceBreakdown');
    const finalPriceP = document.getElementById('finalPrice');
    const gstDisclaimerP = document.getElementById('gstDisclaimer');

    let currentSelectedYacht = null;
    let currentNumPax = 0;

    function isValidPax(val) {
      return Number.isFinite(val) && val > 0;
    }

    function handlePaxInput() {
      const raw = (numPaxInput.value || '').toString().trim();
      const parsed = Number.parseInt(raw, 10);
      currentNumPax = Number.isNaN(parsed) ? 0 : parsed;

      if (isValidPax(currentNumPax)) {
        filterAndDisplayYachts(currentNumPax);
        yachtSelectionSection.classList.remove('hidden');
      } else {
        yachtSelectionSection.classList.add('hidden');
        yachtDetailsAndOptionsDiv.classList.add('hidden');
        priceDisplaySectionDiv.classList.add('hidden');
        currentSelectedYacht = null;
      }
      resetYachtSelection();
    }

    // Robust event binding: input + change + keyup + explicit button
    numPaxInput.addEventListener('input', handlePaxInput);
    numPaxInput.addEventListener('change', handlePaxInput);
    numPaxInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') handlePaxInput(); });
    proceedBtn.addEventListener('click', handlePaxInput);

    function resetYachtSelection() {
      const previouslySelectedId = currentSelectedYacht ? currentSelectedYacht.id : null;
      currentSelectedYacht = null;

      yachtDetailsAndOptionsDiv.classList.add('hidden');
      priceDisplaySectionDiv.classList.add('hidden');

      if (previouslySelectedId) {
        const stillAvailableYacht = yachtData.find(y => y.id === previouslySelectedId && currentNumPax <= y.maxCapacity);
        if (stillAvailableYacht) {
          yachtSelectElement.value = stillAvailableYacht.id;
          selectYacht(stillAvailableYacht);
        } else {
          yachtSelectElement.value = "";
          addonsListDiv.innerHTML = '';
          timeSlotRadios.forEach(radio => radio.checked = false);
          durationInput.value = 4;
          durationValueSpan.textContent = `4 hours`;
          discountSelect.value = "0";
          calculateAndDisplayPrice();
        }
      } else {
        yachtSelectElement.value = "";
        addonsListDiv.innerHTML = '';
        timeSlotRadios.forEach(radio => radio.checked = false);
        durationInput.value = 4;
        durationValueSpan.textContent = `4 hours`;
        discountSelect.value = "0";
        calculateAndDisplayPrice();
      }
    }

    function filterAndDisplayYachts(pax) {
      yachtSelectElement.innerHTML = '<option value="">-- Select a Yacht --</option>';
      const availableYachts = yachtData.filter(yacht => pax <= yacht.maxCapacity);

      if (availableYachts.length === 0) {
        noYachtMessage.classList.remove('hidden');
        yachtSelectElement.classList.add('hidden');
      } else {
        noYachtMessage.classList.add('hidden');
        yachtSelectElement.classList.remove('hidden');
        availableYachts.forEach(yacht => {
          const option = document.createElement('option');
          option.value = yacht.id;
          let displayText = `${yacht.name} (Max: ${yacht.maxCapacity}pax)`;
          if (!yacht.hasTieredPaxPricing && !yacht.hasSpecial5hrRate && yacht.basePax !== undefined) {
            displayText = `${yacht.name} (Base: ${yacht.basePax}pax, Max: ${yacht.maxCapacity}pax)`;
          } else if (yacht.hasTieredPaxPricing) {
            displayText = `${yacht.name} (Up to ${yacht.maxCapacity}pax - Tiered Pricing)`;
          } else if (yacht.hasSpecial5hrRate) {
            displayText = `${yacht.name} (Base: ${yacht.basePax}pax, Max: ${yacht.maxCapacity}pax - Special 5hr Rate)`;
          } else if (yacht.variableExtraPax && (yacht.basePax || yacht.basePax === 0)) {
            displayText = `${yacht.name} (Base: ${yacht.basePax}pax, Max: ${yacht.maxCapacity}pax)`;
          }
          option.textContent = displayText;
          yachtSelectElement.appendChild(option);
        });
      }
      if (currentSelectedYacht && availableYachts.some(y => y.id === currentSelectedYacht.id)) {
        yachtSelectElement.value = currentSelectedYacht.id;
      } else if (currentSelectedYacht && !availableYachts.some(y => y.id === currentSelectedYacht.id)) {
        currentSelectedYacht = null;
        yachtDetailsAndOptionsDiv.classList.add('hidden');
        priceDisplaySectionDiv.classList.add('hidden');
        yachtSelectElement.value = "";
      } else {
        yachtSelectElement.value = "";
      }
    }

    yachtSelectElement.addEventListener('change', (event) => {
      const selectedYachtId = event.target.value;
      if (selectedYachtId) {
        const yacht = yachtData.find(y => y.id === selectedYachtId);
        if (yacht) selectYacht(yacht);
      } else {
        currentSelectedYacht = null;
        yachtDetailsAndOptionsDiv.classList.add('hidden');
        priceDisplaySectionDiv.classList.add('hidden');
        calculateAndDisplayPrice();
      }
    });

    function selectYacht(yacht) {
      if (currentSelectedYacht && currentSelectedYacht.id !== yacht.id) {
        if (currentSelectedYacht.addons) currentSelectedYacht.addons.forEach(addon => addon.selected = false);
      }

      currentSelectedYacht = yacht;
      if (currentSelectedYacht.addons) {
        currentSelectedYacht.addons.forEach(addon => { if (typeof addon.selected === 'undefined') addon.selected = false; });
      }

      let basePaxInfo = `<strong>Base Pax:</strong> ${yacht.basePax ?? '—'}`;
      if (yacht.hasTieredPaxPricing) {
        basePaxInfo = `<strong>Pricing:</strong> Tiered by passenger count`;
      } else if (yacht.hasSpecial5hrRate) {
        basePaxInfo = `<strong>Base Pax:</strong> ${yacht.basePax} (Special 5hr rates apply)`;
      }

      selectedYachtInfoDiv.innerHTML = `
        <h3 class="text-xl font-bold text-indigo-700 mb-2">${yacht.name}</h3>
        <p class="text-sm text-gray-700 mb-1">${basePaxInfo}</p>
        <p class="text-sm text-gray-700 mb-1"><strong>Max Capacity:</strong> ${yacht.maxCapacity}</p>
        <p class="text-sm text-gray-700 mb-1"><strong>Extra Pax Charge:</strong> ${
          currentSelectedYacht.hasTieredPaxPricing ? 'Included in Tier Price'
          : (currentSelectedYacht.hasSpecial5hrRate ? 'Varies by season (see breakdown)'
          : (currentSelectedYacht.variableExtraPax ? 'Varies by season (see breakdown)' : ('$' + (currentSelectedYacht.extraPaxCost||0) + '/person')))
        }</p>
        <div class="mt-3">
          <h4 class="text-md font-semibold text-gray-800 mb-1">Included Services:</h4>
          <p class="text-sm text-gray-600 whitespace-pre-line">${yacht.includedServices || "N/A"}</p>
        </div>
      `;

      renderAddons(yacht);
      yachtDetailsAndOptionsDiv.classList.remove('hidden');
      calculateAndDisplayPrice();
    }

    function renderAddons(yacht) {
      addonsListDiv.innerHTML = '';
      if (yacht.addons && yacht.addons.length > 0) {
        addonsSectionDiv.classList.remove('hidden');
        yacht.addons.forEach((addon) => {
          const addonId = addon.id;
          const div = document.createElement('div');
          div.className = 'flex items-center';
          div.innerHTML = `
            <input type="checkbox" id="${addonId}" name="${addonId}" value="${addon.price}"
              class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" ${addon.selected ? 'checked' : ''}>
            <label for="${addonId}" class="ml-2 block text-sm text-gray-900">${addon.name} - $${addon.price}</label>
          `;
          const checkbox = div.querySelector('input[type="checkbox"]');
          checkbox.addEventListener('change', (event) => {
            const changedAddon = currentSelectedYacht.addons.find(a => a.id === addonId);
            if (changedAddon) changedAddon.selected = event.target.checked;
            calculateAndDisplayPrice();
          });
          addonsListDiv.appendChild(div);
        });
      } else {
        addonsSectionDiv.classList.add('hidden');
      }
    }

    durationInput.addEventListener('input', (event) => {
      durationValueSpan.textContent = `${event.target.value} hours`;
      calculateAndDisplayPrice();
    });

    timeSlotRadios.forEach(radio => radio.addEventListener('change', calculateAndDisplayPrice));
    discountSelect.addEventListener('change', calculateAndDisplayPrice);

    function calculateAndDisplayPrice() {
      if (!currentSelectedYacht || !document.querySelector('input[name="timeslot"]:checked')) {
        priceDisplaySectionDiv.classList.add('hidden');
        return;
      }

      const numPax = Number.parseInt(numPaxInput.value, 10) || 0;
      if (numPax === 0) { priceDisplaySectionDiv.classList.add('hidden'); return; }

      const selectedTimeSlotValue = document.querySelector('input[name="timeslot"]:checked').value;
      const duration = Number.parseInt(durationInput.value, 10);
      const discountRate = Number.parseFloat(discountSelect.value);

      let baseRateForCalculation = 0;
      let displayBaseRate = 0;
      let displayBaseDurationText = "";
      let subsequentHourRate = 0;
      let extraPaxCost = 0;
      let extraPaxCount = 0;
      let currentExtraPaxRate = 0;

      if (currentSelectedYacht.hasTieredPaxPricing) {
        const tiers = currentSelectedYacht.priceTiers[selectedTimeSlotValue];
        let foundTier = false;
        if (tiers) {
          for (const tier of tiers) {
            if (numPax <= tier.upToPax) {
              baseRateForCalculation = tier.base4h;
              displayBaseRate = tier.base4h;
              displayBaseDurationText = `(4 hours for up to ${tier.upToPax} pax)`;
              foundTier = true;
              break;
            }
          }
          if (!foundTier && tiers.length > 0) {
            baseRateForCalculation = tiers[tiers.length - 1].base4h;
            displayBaseRate = baseRateForCalculation;
            displayBaseDurationText = `(4 hours for up to ${tiers[tiers.length - 1].upToPax} pax)`;
          } else if (!foundTier) {
            priceDisplaySectionDiv.classList.add('hidden'); return;
          }
        } else {
          priceDisplaySectionDiv.classList.add('hidden');
          return;
        }
        subsequentHourRate = currentSelectedYacht.subsequentHourRateForAllTiers;
        extraPaxCost = 0;
        extraPaxCount = 0;
        currentExtraPaxRate = 0;

      } else if (currentSelectedYacht.hasSpecial5hrRate) {
        const yachtTimeslotPrices = currentSelectedYacht.prices[selectedTimeSlotValue];
        if (duration === 4) {
          baseRateForCalculation = yachtTimeslotPrices.base4h;
          displayBaseRate = yachtTimeslotPrices.base4h;
          displayBaseDurationText = `(4 hours for ${currentSelectedYacht.basePax} pax)`;
        } else if (duration === 5) {
          baseRateForCalculation = yachtTimeslotPrices.base5h;
          displayBaseRate = yachtTimeslotPrices.base5h;
          displayBaseDurationText = `(5 hours for ${currentSelectedYacht.basePax} pax)`;
        } else {
          baseRateForCalculation = yachtTimeslotPrices.base5h;
          displayBaseRate = yachtTimeslotPrices.base5h;
          displayBaseDurationText = `(5 hours base for ${currentSelectedYacht.basePax} pax)`;
        }
        if (numPax > currentSelectedYacht.basePax) {
          extraPaxCount = numPax - currentSelectedYacht.basePax;
        }
        currentExtraPaxRate = yachtTimeslotPrices.specificExtraPaxCost !== undefined ? yachtTimeslotPrices.specificExtraPaxCost : currentSelectedYacht.extraPaxCost;
        extraPaxCost = extraPaxCount * currentExtraPaxRate;
        subsequentHourRate = yachtTimeslotPrices.subsequentHour;

      } else {
        const yachtTimeslotPrices = currentSelectedYacht.prices[selectedTimeSlotValue];
        baseRateForCalculation = yachtTimeslotPrices.base4h;
        displayBaseRate = yachtTimeslotPrices.base4h;
        subsequentHourRate = yachtTimeslotPrices.subsequentHour;
        displayBaseDurationText = `(4 hours for ${currentSelectedYacht.basePax} pax)`;

        if (numPax > currentSelectedYacht.basePax) {
          extraPaxCount = numPax - currentSelectedYacht.basePax;
        }
        currentExtraPaxRate = currentSelectedYacht.variableExtraPax && yachtTimeslotPrices.specificExtraPaxCost !== undefined ? yachtTimeslotPrices.specificExtraPaxCost : currentSelectedYacht.extraPaxCost;
        extraPaxCost = extraPaxCount * currentExtraPaxRate;
      }

      let extraHoursCalc = 0;
      if (currentSelectedYacht.hasSpecial5hrRate && duration > 5) {
        extraHoursCalc = duration - 5;
      } else if (!currentSelectedYacht.hasSpecial5hrRate) {
        extraHoursCalc = Math.max(0, duration - 4);
      }

      let currentSubsequentHourRate = currentSelectedYacht.hasTieredPaxPricing ? currentSelectedYacht.subsequentHourRateForAllTiers : subsequentHourRate;
      let extraHourCost = extraHoursCalc * currentSubsequentHourRate;

      let subtotalBeforeDiscount = baseRateForCalculation + extraHourCost + extraPaxCost;
      let discountAmount = subtotalBeforeDiscount * discountRate;
      let subtotalAfterDiscount = subtotalBeforeDiscount - discountAmount;

      let addonsTotal = 0;
      if (currentSelectedYacht.addons) {
        currentSelectedYacht.addons.forEach(addon => { if (addon.selected) addonsTotal += addon.price; });
      }

      let totalBeforeGSTCalculation = subtotalAfterDiscount + addonsTotal;
      let gstAmount = 0;
      let finalTotal = 0;

      if (currentSelectedYacht.gstApplicable) {
        gstAmount = totalBeforeGSTCalculation * 0.09;
        finalTotal = totalBeforeGSTCalculation + gstAmount;
        gstDisclaimerP.textContent = "Prices are subject to 9% GST.";
      } else {
        finalTotal = totalBeforeGSTCalculation;
        gstAmount = 0;
        gstDisclaimerP.textContent = "All prices are NETT (GST included).";
      }

      priceBreakdownDiv.innerHTML = `
        <dl class="space-y-1">
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1">
            <dt class="font-medium text-gray-600">Base Yacht Fee ${displayBaseDurationText}:</dt>
            <dd class="text-gray-800 sm:col-span-2 text-right">$ ${displayBaseRate.toFixed(2)}</dd>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1">
            <dt class="font-medium text-gray-600">Extra Duration (${extraHoursCalc} hours):</dt>
            <dd class="text-gray-800 sm:col-span-2 text-right">$ ${extraHourCost.toFixed(2)}</dd>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1">
            <dt class="font-medium text-gray-600">Extra Passengers (${extraPaxCount} pax @ $${currentExtraPaxRate}/pax):</dt>
            <dd class="text-gray-800 sm:col-span-2 text-right">$ ${extraPaxCost.toFixed(2)}</dd>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1 border-t border-gray-200 pt-1">
            <dt class="font-medium text-gray-600">Subtotal (before discount):</dt>
            <dd class="text-gray-800 sm:col-span-2 text-right">$ ${subtotalBeforeDiscount.toFixed(2)}</dd>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1 text-red-600">
            <dt class="font-medium">Discount (${(discountRate * 100).toFixed(0)}%):</dt>
            <dd class="sm:col-span-2 text-right">-$ ${discountAmount.toFixed(2)}</dd>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1 border-t border-gray-200 pt-1">
            <dt class="font-medium text-gray-600">Subtotal (after discount):</dt>
            <dd class="text-gray-800 sm:col-span-2 text-right">$ ${subtotalAfterDiscount.toFixed(2)}</dd>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1">
            <dt class="font-medium text-gray-600">Add-on Services Total:</dt>
            <dd class="text-gray-800 sm:col-span-2 text-right">$ ${addonsTotal.toFixed(2)}</dd>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1 font-semibold border-t border-gray-200 pt-1">
            <dt class="font-medium text-gray-600">Total ${currentSelectedYacht.gstApplicable ? '(before GST)' : '(NETT)'}:</dt>
            <dd class="text-gray-800 sm:col-span-2 text-right">$ ${totalBeforeGSTCalculation.toFixed(2)}</dd>
          </div>
          ${currentSelectedYacht.gstApplicable ? `
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-1 py-1">
            <dt class="font-medium text-gray-600">GST (9%):</dt>
            <dd class="text-gray-800 sm:col-span-2 text-right">$ ${gstAmount.toFixed(2)}</dd>
          </div>` : ''}
        </dl>
      `;

      finalPriceP.textContent = `Total Price: $${finalTotal.toFixed(2)}`;
      priceDisplaySectionDiv.classList.remove('hidden');
    }

    // Initial setup
    yachtSelectionSection.classList.add('hidden');
    yachtDetailsAndOptionsDiv.classList.add('hidden');
    priceDisplaySectionDiv.classList.add('hidden');
  }); // DOMContentLoaded
  </script>
</body>
</html>
